function _isIpad(){var t=-1!==navigator.userAgent.toLowerCase().indexOf("ipad");return!!(!t&&navigator.userAgent.match(/Mac/)&&navigator.maxTouchPoints&&2<navigator.maxTouchPoints)||t}function Runner(t,e){if(Runner.instance_)return Runner.instance_;(Runner.instance_=this).outerContainerEl=document.querySelector(t),this.containerEl=null,this.snackbarEl=null,this.touchController=null,this.config=e||Object.assign(Runner.config,Runner.normalConfig),this.dimensions=Runner.defaultDimensions,this.gameType=null,Runner.spriteDefinition=Runner.spriteDefinitionByType.original,this.altGameImageSprite=null,this.altGameModeActive=!1,this.altGameModeFlashTimer=null,this.fadeInTimer=0,this.canvas=null,this.canvasCtx=null,this.tRex=null,this.distanceMeter=null,this.distanceRan=0,this.highestScore=window.localStorage.getItem("chrome-dino"),this.syncHighestScore=!1,this.time=0,this.runningTime=0,this.msPerFrame=1e3/FPS,this.currentSpeed=this.config.SPEED,Runner.slowDown=!1,this.obstacles=[],this.activated=!1,this.playing=!1,this.crashed=!1,this.paused=!1,this.inverted=!1,this.invertTimer=0,this.resizeTimerId_=null,this.playCount=0,this.audioBuffer=null,this.soundFx={},this.generatedSoundFx=null,this.audioContext=null,this.images={},this.imagesLoaded=0,this.pollingGamepads=!1,this.gamepadIndex=void 0,this.previousGamepad=null,this.isDisabled()?this.setupDisabledRunner():(Runner.isAltGameModeEnabled()&&(this.initAltGameType(),Runner.gameType=this.gameType),this.loadImages(),window.initializeEasterEggHighScore=this.initializeHighScore.bind(this))}const DEFAULT_WIDTH=600,FPS=60,IS_HIDPI=1<window.devicePixelRatio,IS_IOS=!!window.navigator.userAgent.match(/iP(hone|ad|od)/i)&&!!window.navigator.userAgent.match(/Safari/i)||_isIpad()||/CriOS/.test(window.navigator.userAgent)||/FxiOS/.test(window.navigator.userAgent),IS_MOBILE=/Android/.test(window.navigator.userAgent)||IS_IOS,IS_RTL="rtl"==document.querySelector("html").dir,ARCADE_MODE_URL="chrome://dino/",RESOURCE_POSTFIX="offline-resources-",A11Y_STRINGS={ariaLabel:"dinoGameA11yAriaLabel",description:"dinoGameA11yDescription",gameOver:"dinoGameA11yGameOver",highScore:"dinoGameA11yHighScore",jump:"dinoGameA11yJump",started:"dinoGameA11yStartGame",speedLabel:"dinoGameA11ySpeedToggle"};function GeneratedSoundFx(){this.audioCues=!1,this.context=null,this.panner=null}function speakPhrase(t){if("speechSynthesis"in window){const e=new SpeechSynthesisUtterance(t);window.speechSynthesis.getVoices();e.text=t,speechSynthesis.speak(e)}}function announcePhrase(t){Runner.a11yStatusEl&&(Runner.a11yStatusEl.textContent="",Runner.a11yStatusEl.textContent=t)}function getA11yString(t){return loadTimeData&&loadTimeData.valueExists(t)?loadTimeData.getString(t):""}function getRandomNum(t,e){return Math.floor(Math.random()*(e-t+1))+t}function vibrate(t){IS_MOBILE&&window.navigator.vibrate&&window.navigator.vibrate(t)}function createCanvas(t,e,i,s){const n=document.createElement("canvas");return n.className=s?Runner.classes.CANVAS+" "+s:Runner.classes.CANVAS,n.width=e,n.height=i,t.appendChild(n),n}function decodeBase64ToArrayBuffer(t){var e=t.length/4*3;const i=atob(t);t=new ArrayBuffer(e);const s=new Uint8Array(t);for(let t=0;t<e;t++)s[t]=i.charCodeAt(t);return s.buffer}function getTimeStamp(){return IS_IOS?(new Date).getTime():performance.now()}function GameOverPanel(t,e,i,s,n,a){this.canvas=t,this.canvasCtx=t.getContext("2d"),this.canvasDimensions=s,this.textImgPos=e,this.restartImgPos=i,this.altGameEndImgPos=n,this.altGameModeActive=a,this.frameTimeStamp=0,this.animTimer=0,this.currentFrame=0,this.gameOverRafId=null,this.flashTimer=0,this.flashCounter=0,this.originalText=!0}function checkForCollision(t,e,s){Runner.defaultDimensions.WIDTH,t.xPos;var n=new CollisionBox(e.xPos+1,e.yPos+1,e.config.WIDTH-2,e.config.HEIGHT-2),a=new CollisionBox(t.xPos+1,t.yPos+1,t.typeConfig.width*t.size-2,t.typeConfig.height-2);if(s&&drawCollisionBoxes(s,n,a),boxCompare(n,a)){var o=t.collisionBoxes;let i=[];i=Runner.isAltGameModeEnabled()?Runner.spriteDefinition.TREX.COLLISION_BOXES:e.ducking?Trex.collisionBoxes.DUCKING:Trex.collisionBoxes.RUNNING;for(let e=0;e<i.length;e++)for(let t=0;t<o.length;t++){var h=createAdjustedCollisionBox(i[e],n),r=createAdjustedCollisionBox(o[t],a),l=boxCompare(h,r);if(s&&drawCollisionBoxes(s,h,r),l)return[h,r]}}}function createAdjustedCollisionBox(t,e){return new CollisionBox(t.x+e.x,t.y+e.y,t.width,t.height)}function drawCollisionBoxes(t,e,i){t.save(),t.strokeStyle="#f00",t.strokeRect(e.x,e.y,e.width,e.height),t.strokeStyle="#0f0",t.strokeRect(i.x,i.y,i.width,i.height),t.restore()}function boxCompare(t,e){let i=!1;t.x,t.y;var s=e.x;e.y;return t.x<s+e.width&&t.x+t.width>s&&t.y<e.y+e.height&&t.height+t.y>e.y&&(i=!0),i}function CollisionBox(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s}function Obstacle(t,e,i,s,n,a,o,h){this.canvasCtx=t,this.spritePos=i,this.typeConfig=e,this.gapCoefficient=Runner.slowDown?2*n:n,this.size=getRandomNum(1,Obstacle.MAX_OBSTACLE_LENGTH),this.dimensions=s,this.remove=!1,this.xPos=s.WIDTH+(o||0),this.yPos=0,this.width=0,this.collisionBoxes=[],this.gap=0,this.speedOffset=0,this.altGameModeActive=h,this.imageSprite="COLLECTABLE"==this.typeConfig.type?Runner.altCommonImageSprite:this.altGameModeActive?Runner.altGameImageSprite:Runner.imageSprite,this.currentFrame=0,this.timer=0,this.init(a)}function Trex(t,e){this.canvas=t,this.canvasCtx=t.getContext("2d"),this.spritePos=e,this.xPos=0,this.yPos=0,this.xInitialPos=0,this.groundYPos=0,this.currentFrame=0,this.currentAnimFrames=[],this.blinkDelay=0,this.blinkCount=0,this.animStartTime=0,this.timer=0,this.msPerFrame=1e3/FPS,this.config=Object.assign(Trex.config,Trex.normalJumpConfig),this.status=Trex.status.WAITING,this.jumping=!1,this.ducking=!1,this.jumpVelocity=0,this.reachedMinHeight=!1,this.speedDrop=!1,this.jumpCount=0,this.jumpspotX=0,this.altGameModeEnabled=!1,this.flashing=!1,this.init()}function DistanceMeter(t,e,i){this.canvas=t,this.canvasCtx=t.getContext("2d"),this.image=Runner.imageSprite,this.spritePos=e,this.x=0,this.y=5,this.currentDistance=0,this.maxScore=0,this.highScore="0",this.container=null,this.digits=[],this.achievement=!1,this.defaultString="",this.flashTimer=0,this.flashIterations=0,this.invertTrigger=!1,this.flashingRafId=null,this.highScoreBounds={},this.highScoreFlashing=!1,this.config=DistanceMeter.config,this.maxScoreUnits=this.config.MAX_DISTANCE_UNITS,this.canvasWidth=i,this.init(i)}function Cloud(t,e,i){this.canvas=t,this.canvasCtx=this.canvas.getContext("2d"),this.spritePos=e,this.containerWidth=i,this.xPos=i,this.yPos=0,this.remove=!1,this.gap=getRandomNum(Cloud.config.MIN_CLOUD_GAP,Cloud.config.MAX_CLOUD_GAP),this.init()}function BackgroundEl(t,e,i,s){this.canvas=t,this.canvasCtx=this.canvas.getContext("2d"),this.spritePos=e,this.containerWidth=i,this.xPos=i,this.yPos=0,this.remove=!1,this.type=s,this.gap=getRandomNum(BackgroundEl.config.MIN_GAP,BackgroundEl.config.MAX_GAP),this.animTimer=0,this.switchFrames=!1,this.spriteConfig={},this.init()}function NightMode(t,e,i){this.spritePos=e,this.canvas=t,this.canvasCtx=t.getContext("2d"),this.xPos=i-50,this.yPos=30,this.currentPhase=0,this.opacity=0,this.containerWidth=i,this.stars=[],this.drawStars=!1,this.placeStars()}function HorizonLine(t,e){let i=e.SOURCE_X,s=e.SOURCE_Y;IS_HIDPI&&(i*=2,s*=2),this.spritePos={x:i,y:s},this.canvas=t,this.canvasCtx=t.getContext("2d"),this.sourceDimensions={},this.dimensions=e,this.sourceXPos=[this.spritePos.x,this.spritePos.x+this.dimensions.WIDTH],this.xPos=[],this.yPos=0,this.bumpThreshold=.5,this.setSourceDimensions(e),this.draw()}function Horizon(t,e,i,s){this.canvas=t,this.canvasCtx=this.canvas.getContext("2d"),this.config=Horizon.config,this.dimensions=i,this.gapCoefficient=s,this.obstacles=[],this.obstacleHistory=[],this.horizonOffsets=[0,0],this.cloudFrequency=this.config.CLOUD_FREQUENCY,this.spritePos=e,this.nightMode=null,this.altGameModeActive=!1,this.clouds=[],this.cloudSpeed=this.config.BG_CLOUD_SPEED,this.backgroundEls=[],this.lastEl=null,this.backgroundSpeed=this.config.BG_CLOUD_SPEED,this.horizonLine=null,this.horizonLines=[],this.init()}Runner.config={AUDIOCUE_PROXIMITY_THRESHOLD:190,AUDIOCUE_PROXIMITY_THRESHOLD_MOBILE_A11Y:250,BG_CLOUD_SPEED:.2,BOTTOM_PAD:10,CANVAS_IN_VIEW_OFFSET:-10,CLEAR_TIME:3e3,CLOUD_FREQUENCY:.5,FADE_DURATION:1,FLASH_DURATION:1e3,GAMEOVER_CLEAR_TIME:1200,INITIAL_JUMP_VELOCITY:12,INVERT_FADE_DURATION:12e3,MAX_BLINK_COUNT:3,MAX_CLOUDS:6,MAX_OBSTACLE_LENGTH:3,MAX_OBSTACLE_DUPLICATION:2,RESOURCE_TEMPLATE_ID:"audio-resources",SPEED:6,SPEED_DROP_COEFFICIENT:3,ARCADE_MODE_INITIAL_TOP_POSITION:35,ARCADE_MODE_TOP_POSITION_PERCENT:.1},Runner.normalConfig={ACCELERATION:.001,AUDIOCUE_PROXIMITY_THRESHOLD:190,AUDIOCUE_PROXIMITY_THRESHOLD_MOBILE_A11Y:250,GAP_COEFFICIENT:.6,INVERT_DISTANCE:700,MAX_SPEED:13,MOBILE_SPEED_COEFFICIENT:1.2,SPEED:6},Runner.slowConfig={ACCELERATION:5e-4,AUDIOCUE_PROXIMITY_THRESHOLD:170,AUDIOCUE_PROXIMITY_THRESHOLD_MOBILE_A11Y:220,GAP_COEFFICIENT:.3,INVERT_DISTANCE:350,MAX_SPEED:9,MOBILE_SPEED_COEFFICIENT:1.5,SPEED:4.2},Runner.defaultDimensions={WIDTH:DEFAULT_WIDTH,HEIGHT:150},Runner.classes={ARCADE_MODE:"arcade-mode",CANVAS:"runner-canvas",CONTAINER:"runner-container",CRASHED:"crashed",ICON:"icon-offline",INVERTED:"g-dark",SNACKBAR:"snackbar",SNACKBAR_SHOW:"snackbar-show",TOUCH_CONTROLLER:"controller"},Runner.sounds={BUTTON_PRESS:"offline-sound-press",HIT:"offline-sound-hit",SCORE:"offline-sound-reached"},Runner.keycodes={JUMP:{38:1,32:1},DUCK:{40:1},RESTART:{13:1}},Runner.events={ANIM_END:"webkitAnimationEnd",CLICK:"click",KEYDOWN:"keydown",KEYUP:"keyup",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",RESIZE:"resize",TOUCHEND:"touchend",TOUCHSTART:"touchstart",VISIBILITY:"visibilitychange",BLUR:"blur",FOCUS:"focus",LOAD:"load",GAMEPADCONNECTED:"gamepadconnected"},Runner.prototype={initAltGameType(){0<GAME_TYPE.length&&(this.gameType=loadTimeData&&loadTimeData.valueExists("altGameType")?GAME_TYPE[parseInt(loadTimeData.getValue("altGameType"),10)-1]:"")},isDisabled(){return loadTimeData&&loadTimeData.valueExists("disabledEasterEgg")},setupDisabledRunner(){this.containerEl=document.createElement("div"),this.containerEl.className=Runner.classes.SNACKBAR,this.containerEl.textContent=loadTimeData.getValue("disabledEasterEgg"),this.outerContainerEl.appendChild(this.containerEl),document.addEventListener(Runner.events.KEYDOWN,function(t){Runner.keycodes.JUMP[t.keyCode]&&(this.containerEl.classList.add(Runner.classes.SNACKBAR_SHOW),document.querySelector(".icon").classList.add("icon-disabled"))}.bind(this))},updateConfigSetting(t,e){if(t in this.config&&void 0!==e)switch(this.config[t]=e,t){case"GRAVITY":case"MIN_JUMP_HEIGHT":case"SPEED_DROP_COEFFICIENT":this.tRex.config[t]=e;break;case"INITIAL_JUMP_VELOCITY":this.tRex.setJumpVelocity(e);break;case"SPEED":this.setSpeed(e)}},createImageElement(t){var e=loadTimeData&&loadTimeData.valueExists(t)?loadTimeData.getString(t):null;if(e){const i=document.createElement("img");return i.id=t,i.src=e,document.getElementById("offline-resources").appendChild(i),i}return null},loadImages(){let t="1x";this.spriteDef=Runner.spriteDefinition.LDPI,IS_HIDPI&&(t="2x",this.spriteDef=Runner.spriteDefinition.HDPI),Runner.imageSprite=document.getElementById(RESOURCE_POSTFIX+t),this.gameType&&(Runner.altGameImageSprite=this.createImageElement("altGameSpecificImage"+t),Runner.altCommonImageSprite=this.createImageElement("altGameCommonImage"+t)),Runner.origImageSprite=Runner.imageSprite,Runner.altGameImageSprite&&Runner.altCommonImageSprite||(Runner.isAltGameModeEnabled=()=>!1,this.altGameModeActive=!1),Runner.imageSprite.complete?this.init():Runner.imageSprite.addEventListener(Runner.events.LOAD,this.init.bind(this))},loadSounds(){if(!IS_IOS)for(var t in this.audioContext=new AudioContext,Runner.sounds){var e=document.getElementById(Runner.sounds[t]);this.soundFx[t]=e}},setSpeed(t){var e,i=t||this.currentSpeed;this.dimensions.WIDTH<DEFAULT_WIDTH?(e=Runner.slowDown?i:i*this.dimensions.WIDTH/DEFAULT_WIDTH*this.config.MOBILE_SPEED_COEFFICIENT,this.currentSpeed=i<e?i:e):t&&(this.currentSpeed=t)},init(){document.querySelector("."+Runner.classes.ICON).style.visibility="hidden",this.adjustDimensions(),this.setSpeed();var t=getA11yString(A11Y_STRINGS.ariaLabel);this.containerEl=document.createElement("div"),this.containerEl.setAttribute("role",IS_MOBILE?"button":"application"),this.containerEl.setAttribute("tabindex","0"),this.containerEl.setAttribute("title",t),this.containerEl.className=Runner.classes.CONTAINER,this.canvas=createCanvas(this.containerEl,this.dimensions.WIDTH,this.dimensions.HEIGHT),this.a11yStatusEl=document.createElement("span"),this.a11yStatusEl.className="offline-runner-live-region",this.a11yStatusEl.setAttribute("aria-live","assertive"),this.a11yStatusEl.textContent="",Runner.a11yStatusEl=this.a11yStatusEl,this.slowSpeedCheckboxLabel=document.createElement("label"),this.slowSpeedCheckboxLabel.className="slow-speed-option hidden",this.slowSpeedCheckboxLabel.textContent=getA11yString(A11Y_STRINGS.speedLabel),this.slowSpeedCheckbox=document.createElement("input"),this.slowSpeedCheckbox.setAttribute("type","checkbox"),this.slowSpeedCheckbox.setAttribute("title",getA11yString(A11Y_STRINGS.speedLabel)),this.slowSpeedCheckbox.setAttribute("tabindex","0"),this.slowSpeedCheckbox.setAttribute("checked","checked"),this.slowSpeedToggleEl=document.createElement("span"),this.slowSpeedToggleEl.className="slow-speed-toggle",this.slowSpeedCheckboxLabel.appendChild(this.slowSpeedCheckbox),this.slowSpeedCheckboxLabel.appendChild(this.slowSpeedToggleEl),(IS_IOS?this.outerContainerEl:this.containerEl).appendChild(this.a11yStatusEl),announcePhrase(getA11yString(A11Y_STRINGS.description)),this.generatedSoundFx=new GeneratedSoundFx,this.canvasCtx=this.canvas.getContext("2d"),this.canvasCtx.fillStyle="#f7f7f7",this.canvasCtx.fill(),Runner.updateCanvasScaling(this.canvas),this.horizon=new Horizon(this.canvas,this.spriteDef,this.dimensions,this.config.GAP_COEFFICIENT),this.distanceMeter=new DistanceMeter(this.canvas,this.spriteDef.TEXT_SPRITE,this.dimensions.WIDTH),this.tRex=new Trex(this.canvas,this.spriteDef.TREX),this.outerContainerEl.appendChild(this.containerEl),this.outerContainerEl.appendChild(this.slowSpeedCheckboxLabel),this.startListening(),this.update(),window.addEventListener(Runner.events.RESIZE,this.debounceResize.bind(this)),this.isDarkMode="undefined"!=typeof Storage&&"true"===localStorage.getItem("elgoog-dark-mode");let e=document.querySelector("#darkSwitch");e&&e.addEventListener("change",()=>{this.isDarkMode=e.checked})},createTouchController(){this.touchController=document.createElement("div"),this.touchController.className=Runner.classes.TOUCH_CONTROLLER,this.touchController.addEventListener(Runner.events.TOUCHSTART,this),this.touchController.addEventListener(Runner.events.TOUCHEND,this),this.outerContainerEl.appendChild(this.touchController)},debounceResize(){this.resizeTimerId_||(this.resizeTimerId_=setInterval(this.adjustDimensions.bind(this),250))},adjustDimensions(){clearInterval(this.resizeTimerId_),this.resizeTimerId_=null;const t=window.getComputedStyle(this.outerContainerEl);var e=Number(t.paddingLeft.substr(0,t.paddingLeft.length-2));this.dimensions.WIDTH=this.outerContainerEl.offsetWidth-2*e,this.isArcadeMode()&&(this.dimensions.WIDTH=Math.min(DEFAULT_WIDTH,this.dimensions.WIDTH),this.activated&&this.setArcadeModeContainerScale()),this.canvas&&(this.canvas.width=this.dimensions.WIDTH,this.canvas.height=this.dimensions.HEIGHT,Runner.updateCanvasScaling(this.canvas),this.distanceMeter.calcXPos(this.dimensions.WIDTH),this.clearCanvas(),this.horizon.update(0,0,!0),this.tRex.update(0),this.playing||this.crashed||this.paused?(this.containerEl.style.width=this.dimensions.WIDTH+"px",this.containerEl.style.height=this.dimensions.HEIGHT+"px",this.distanceMeter.update(0,Math.ceil(this.distanceRan)),this.stop()):this.tRex.draw(0,0),this.crashed&&this.gameOverPanel&&(this.gameOverPanel.updateDimensions(this.dimensions.WIDTH),this.gameOverPanel.draw(this.altGameModeActive,this.tRex)))},playIntro(){var t,e;this.activated||this.crashed?this.crashed&&this.restart():(this.playingIntro=!0,this.tRex.playingIntro=!0,null!==window.localStorage.getItem("chrome-dino")&&this.distanceMeter.setHighScore(window.localStorage.getItem("chrome-dino")),t="@-webkit-keyframes intro { from { width:"+Trex.config.WIDTH+"px }to { width: "+this.dimensions.WIDTH+"px }}",(e=document.createElement("style")).innerHTML=t,document.head.appendChild(e),this.containerEl.addEventListener(Runner.events.ANIM_END,this.startGame.bind(this)),this.containerEl.style.webkitAnimation="intro .4s ease-out 1 both",this.containerEl.style.width=this.dimensions.WIDTH+"px",this.setPlayStatus(!0),this.activated=!0)},startGame(){this.isArcadeMode()&&this.setArcadeMode(),this.toggleSpeed(),this.runningTime=0,this.playingIntro=!1,this.tRex.playingIntro=!1,this.containerEl.style.webkitAnimation="",this.playCount++,this.generatedSoundFx.background(),announcePhrase(getA11yString(A11Y_STRINGS.started)),Runner.audioCues&&this.containerEl.setAttribute("title",getA11yString(A11Y_STRINGS.jump)),document.addEventListener(Runner.events.VISIBILITY,this.onVisibilityChange.bind(this)),window.addEventListener(Runner.events.BLUR,this.onVisibilityChange.bind(this)),window.addEventListener(Runner.events.FOCUS,this.onVisibilityChange.bind(this)),botStatusRadio.checked&&!autoPlayFlag&&(window.trexBot=setInterval(autoPlay,CHECK_INTERVAL),console.log("Bot Activated!"))},clearCanvas(){this.canvasCtx.clearRect(0,0,this.dimensions.WIDTH,this.dimensions.HEIGHT)},isCanvasInView(){return this.containerEl.getBoundingClientRect().top>Runner.config.CANVAS_IN_VIEW_OFFSET},enableAltGameMode(){Runner.imageSprite=Runner.altGameImageSprite,Runner.spriteDefinition=Runner.spriteDefinitionByType[Runner.gameType],IS_HIDPI?this.spriteDef=Runner.spriteDefinition.HDPI:this.spriteDef=Runner.spriteDefinition.LDPI,this.altGameModeActive=!0,this.tRex.enableAltGameMode(this.spriteDef.TREX),this.horizon.enableAltGameMode(this.spriteDef),this.generatedSoundFx.background()},update(){this.updatePending=!1;var e=getTimeStamp();let i=e-(this.time||e);if(this.altGameModeFlashTimer<0||0===this.altGameModeFlashTimer?(this.altGameModeFlashTimer=null,this.tRex.setFlashing(!1),this.enableAltGameMode()):0<this.altGameModeFlashTimer&&(this.altGameModeFlashTimer-=i,this.tRex.update(i),i=0),this.time=e,this.playing){this.clearCanvas(),this.altGameModeActive&&this.fadeInTimer<=this.config.FADE_DURATION?(this.fadeInTimer+=i/1e3,this.canvasCtx.globalAlpha=this.fadeInTimer):this.canvasCtx.globalAlpha=1,this.tRex.jumping&&this.tRex.updateJump(i),this.runningTime+=i;var s=this.runningTime>this.config.CLEAR_TIME;1!==this.tRex.jumpCount||this.playingIntro||this.playIntro(),this.playingIntro?this.horizon.update(0,this.currentSpeed,s):this.crashed||(e=this.isDarkMode^this.inverted,i=this.activated?i:0,this.horizon.update(i,this.currentSpeed,s,e));let t=s&&checkForCollision(this.horizon.obstacles[0],this.tRex);Runner.audioCues&&s&&(n="COLLECTABLE"!=this.horizon.obstacles[0].typeConfig.type,this.horizon.obstacles[0].jumpAlerted||(s=(s=Runner.isMobileMouseInput?Runner.config.AUDIOCUE_PROXIMITY_THRESHOLD_MOBILE_A11Y:Runner.config.AUDIOCUE_PROXIMITY_THRESHOLD)+s*Math.log10(this.currentSpeed/Runner.config.SPEED),this.horizon.obstacles[0].xPos<s&&(n&&this.generatedSoundFx.jump(),this.horizon.obstacles[0].jumpAlerted=!0))),Runner.isAltGameModeEnabled()&&t&&"COLLECTABLE"==this.horizon.obstacles[0].typeConfig.type&&(this.horizon.removeFirstObstacle(),this.tRex.setFlashing(!0),t=!1,this.altGameModeFlashTimer=this.config.FLASH_DURATION,this.runningTime=0,this.generatedSoundFx.collect()),t?this.gameOver():(this.distanceRan+=this.currentSpeed*i/this.msPerFrame,this.currentSpeed<this.config.MAX_SPEED&&(this.currentSpeed+=this.config.ACCELERATION));var n=this.distanceMeter.update(i,Math.ceil(this.distanceRan));!Runner.audioCues&&n&&this.playSound(this.soundFx.SCORE),Runner.isAltGameModeEnabled()||(this.invertTimer>this.config.INVERT_FADE_DURATION?(this.invertTimer=0,this.invertTrigger=!1,this.invert(!1)):this.invertTimer?this.invertTimer+=i:0<(n=this.distanceMeter.getActualDistance(Math.ceil(this.distanceRan)))&&(this.invertTrigger=!(n%this.config.INVERT_DISTANCE),this.invertTrigger&&0===this.invertTimer&&(this.invertTimer+=i,this.invert(!1))))}(this.playing||!this.activated&&this.tRex.blinkCount<Runner.config.MAX_BLINK_COUNT)&&(this.tRex.update(i),this.scheduleNextUpdate())},handleEvent(i){return function(t,e){switch(t){case e.KEYDOWN:case e.TOUCHSTART:case e.POINTERDOWN:this.onKeyDown(i);break;case e.KEYUP:case e.TOUCHEND:case e.POINTERUP:this.onKeyUp(i);break;case e.GAMEPADCONNECTED:this.onGamepadConnected(i)}}.bind(this)(i.type,Runner.events)},handleCanvasKeyPress(t){this.activated||Runner.audioCues?t.keyCode&&Runner.keycodes.JUMP[t.keyCode]&&this.onKeyDown(t):(this.toggleSpeed(),Runner.audioCues=!0,this.generatedSoundFx.init(),Runner.generatedSoundFx=this.generatedSoundFx,Runner.config.CLEAR_TIME*=1.2)},preventScrolling(t){32===t.keyCode&&t.preventDefault()},toggleSpeed(){var t;Runner.audioCues&&(Runner.slowDown!=this.slowSpeedCheckbox.checked&&(Runner.slowDown=this.slowSpeedCheckbox.checked,t=Runner.slowDown?Runner.slowConfig:Runner.normalConfig,Runner.config=Object.assign(Runner.config,t),this.currentSpeed=t.SPEED,this.tRex.enableSlowConfig(),this.horizon.adjustObstacleSpeed()),this.playing&&this.disableSpeedToggle(!0))},showSpeedToggle(t){t=t&&"focus"==t.type;(Runner.audioCues||t)&&this.slowSpeedCheckboxLabel.classList.toggle(HIDDEN_CLASS,!t&&!this.crashed)},disableSpeedToggle(t){t?this.slowSpeedCheckbox.setAttribute("disabled","disabled"):this.slowSpeedCheckbox.removeAttribute("disabled")},startListening(){this.containerEl.addEventListener(Runner.events.KEYDOWN,this.handleCanvasKeyPress.bind(this)),IS_MOBILE||this.containerEl.addEventListener(Runner.events.FOCUS,this.showSpeedToggle.bind(this)),this.canvas.addEventListener(Runner.events.KEYDOWN,this.preventScrolling.bind(this)),this.canvas.addEventListener(Runner.events.KEYUP,this.preventScrolling.bind(this)),document.addEventListener(Runner.events.KEYDOWN,this),document.addEventListener(Runner.events.KEYUP,this),this.containerEl.addEventListener(Runner.events.TOUCHSTART,this),document.addEventListener(Runner.events.POINTERDOWN,this),document.addEventListener(Runner.events.POINTERUP,this),this.isArcadeMode()&&window.addEventListener(Runner.events.GAMEPADCONNECTED,this)},stopListening(){document.removeEventListener(Runner.events.KEYDOWN,this),document.removeEventListener(Runner.events.KEYUP,this),this.touchController&&(this.touchController.removeEventListener(Runner.events.TOUCHSTART,this),this.touchController.removeEventListener(Runner.events.TOUCHEND,this)),this.containerEl.removeEventListener(Runner.events.TOUCHSTART,this),document.removeEventListener(Runner.events.POINTERDOWN,this),document.removeEventListener(Runner.events.POINTERUP,this),this.isArcadeMode()&&window.removeEventListener(Runner.events.GAMEPADCONNECTED,this)},onKeyDown(t){var e;IS_MOBILE&&this.playing&&t.preventDefault(),this.isCanvasInView()&&(Runner.keycodes.JUMP[t.keyCode]&&t.target==this.slowSpeedCheckbox||this.crashed||this.paused||(e=IS_MOBILE&&t.type===Runner.events.POINTERDOWN&&"mouse"==t.pointerType&&t.target==this.containerEl||IS_IOS&&"touch"==t.pointerType&&document.activeElement==this.containerEl,Runner.keycodes.JUMP[t.keyCode]||t.type===Runner.events.TOUCHSTART||e||Runner.keycodes.DUCK[t.keyCode]&&this.altGameModeActive?(t.preventDefault(),this.playing||(this.touchController||t.type!==Runner.events.TOUCHSTART||this.createTouchController(),e&&this.handleCanvasKeyPress(t),this.loadSounds(),this.setPlayStatus(!0),this.update(),window.errorPageController&&errorPageController.trackEasterEgg()),this.tRex.jumping||this.tRex.ducking||(Runner.audioCues?this.generatedSoundFx.cancelFootSteps():this.playSound(this.soundFx.BUTTON_PRESS),this.tRex.startJump(this.currentSpeed))):!this.altGameModeActive&&this.playing&&Runner.keycodes.DUCK[t.keyCode]&&(t.preventDefault(),this.tRex.jumping?this.tRex.setSpeedDrop():this.tRex.jumping||this.tRex.ducking||this.tRex.setDuck(!0))))},onKeyUp(t){var e,i=String(t.keyCode),s=Runner.keycodes.JUMP[i]||t.type===Runner.events.TOUCHEND||t.type===Runner.events.POINTERUP;this.isRunning()&&s?this.tRex.endJump():Runner.keycodes.DUCK[i]?(this.tRex.speedDrop=!1,this.tRex.setDuck(!1)):this.crashed?(e=getTimeStamp()-this.time,this.isCanvasInView()&&(Runner.keycodes.RESTART[i]||this.isLeftClickOnCanvas(t)||e>=this.config.GAMEOVER_CLEAR_TIME&&Runner.keycodes.JUMP[i])&&this.handleGameOverClicks(t)):this.paused&&s&&(this.tRex.reset(),this.play())},onGamepadConnected(t){this.pollingGamepads||this.pollGamepadState()},pollGamepadState(){var t=navigator.getGamepads();this.pollActiveGamepad(t),this.pollingGamepads=!0,requestAnimationFrame(this.pollGamepadState.bind(this))},pollForActiveGamepad(e){for(let t=0;t<e.length;++t)if(e[t]&&0<e[t].buttons.length&&e[t].buttons[0].pressed)return this.gamepadIndex=t,void this.pollActiveGamepad(e)},pollActiveGamepad(t){if(void 0!==this.gamepadIndex){var e=t[this.gamepadIndex];if(!e)return this.gamepadIndex=void 0,void this.pollForActiveGamepad(t);this.pollGamepadButton(e,0,38),2<=e.buttons.length&&this.pollGamepadButton(e,1,40),10<=e.buttons.length&&this.pollGamepadButton(e,9,13),this.previousGamepad=e}else this.pollForActiveGamepad(t)},pollGamepadButton(t,e,i){t=t.buttons[e].pressed;let s=!1;this.previousGamepad&&(s=this.previousGamepad.buttons[e].pressed),t!==s&&(i=new KeyboardEvent(t?Runner.events.KEYDOWN:Runner.events.KEYUP,{keyCode:i}),document.dispatchEvent(i))},handleGameOverClicks(t){t.target!=this.slowSpeedCheckbox&&(t.preventDefault(),this.distanceMeter.hasClickedOnHighScore(t)&&this.highestScore?this.distanceMeter.isHighScoreFlashing()?(this.saveHighScore(0,!0),this.distanceMeter.resetHighScore(),this.distanceMeter.setHighScore(window.localStorage.removeItem("chrome-dino"))):this.distanceMeter.startHighScoreFlashing():(this.distanceMeter.cancelHighScoreFlashing(),this.restart()))},isLeftClickOnCanvas(t){return null!=t.button&&t.button<2&&t.type===Runner.events.POINTERUP&&(t.target===this.canvas||IS_MOBILE&&Runner.audioCues&&t.target===this.containerEl)},scheduleNextUpdate(){this.updatePending||(this.updatePending=!0,this.raqId=requestAnimationFrame(this.update.bind(this)))},isRunning(){return!!this.raqId},initializeHighScore(t){this.syncHighestScore=!0,(t=Math.ceil(t))<this.highestScore?window.errorPageController&&errorPageController.updateEasterEggHighScore(this.highestScore):(this.highestScore=t,this.distanceMeter.setHighScore(this.highestScore))},saveHighScore(t,e){this.highestScore=Math.ceil(t),this.distanceMeter.setHighScore(this.highestScore),this.syncHighestScore&&window.errorPageController&&(e?errorPageController.resetEasterEggHighScore():errorPageController.updateEasterEggHighScore(this.highestScore))},gameOver(){var t;this.playSound(this.soundFx.HIT),vibrate(200),this.stop(),this.crashed=!0,this.distanceMeter.achievement=!1,this.tRex.update(100,Trex.status.CRASHED),this.gameOverPanel||(t=IS_HIDPI?Runner.spriteDefinitionByType.original.HDPI:Runner.spriteDefinitionByType.original.LDPI,this.canvas&&(Runner.isAltGameModeEnabled?this.gameOverPanel=new GameOverPanel(this.canvas,t.TEXT_SPRITE,t.RESTART,this.dimensions,t.ALT_GAME_END,this.altGameModeActive):this.gameOverPanel=new GameOverPanel(this.canvas,t.TEXT_SPRITE,t.RESTART,this.dimensions))),this.gameOverPanel.draw(this.altGameModeActive,this.tRex),this.distanceRan>this.highestScore&&(this.saveHighScore(this.distanceRan),window.localStorage.setItem("chrome-dino",this.distanceRan)),this.time=getTimeStamp(),Runner.audioCues&&(this.generatedSoundFx.stopAll(),announcePhrase(getA11yString(A11Y_STRINGS.gameOver).replace("$1",this.distanceMeter.getActualDistance(this.distanceRan).toString())+" "+getA11yString(A11Y_STRINGS.highScore).replace("$1",this.distanceMeter.getActualDistance(this.highestScore).toString())),this.containerEl.setAttribute("title",getA11yString(A11Y_STRINGS.ariaLabel))),this.showSpeedToggle(),this.disableSpeedToggle(!1)},stop(){this.setPlayStatus(!1),this.paused=!0,cancelAnimationFrame(this.raqId),this.raqId=0,this.generatedSoundFx.stopAll()},play(){this.crashed||(this.setPlayStatus(!0),this.paused=!1,this.tRex.update(0,Trex.status.RUNNING),this.time=getTimeStamp(),this.update(),this.generatedSoundFx.background())},restart(){this.raqId||(this.playCount++,this.runningTime=0,this.setPlayStatus(!0),this.toggleSpeed(),this.paused=!1,this.crashed=!1,this.distanceRan=0,this.setSpeed(this.config.SPEED),this.time=getTimeStamp(),this.containerEl.classList.remove(Runner.classes.CRASHED),this.clearCanvas(),this.distanceMeter.reset(),this.horizon.reset(),this.tRex.reset(),this.playSound(this.soundFx.BUTTON_PRESS),this.invert(!0),this.flashTimer=null,this.update(),this.gameOverPanel.reset(),this.generatedSoundFx.background(),this.containerEl.setAttribute("title",getA11yString(A11Y_STRINGS.jump)),announcePhrase(getA11yString(A11Y_STRINGS.started)))},setPlayStatus(t){this.touchController&&this.touchController.classList.toggle(HIDDEN_CLASS,!t),this.playing=t},isArcadeMode(){return!0},setArcadeMode(){document.body.classList.add(Runner.classes.ARCADE_MODE),this.setArcadeModeContainerScale()},setArcadeModeContainerScale(){var t=window.innerHeight/this.dimensions.HEIGHT,e=window.innerWidth/this.dimensions.WIDTH;const i=Math.max(1,Math.min(t,e)),s=this.dimensions.HEIGHT*i;this.containerEl.style.transform="scale("+i+")","rtl"===document.documentElement.getAttribute("dir")&&(this.containerEl.style.transform="scaleX(-1) scale("+i+")"),0<translateElements.length&&translateElements.forEach(function(t){t.style.transform="translateY("+(s-s/i)+"px)"})},onVisibilityChange(t){document.hidden||document.webkitHidden||"blur"===t.type||"visible"!==document.visibilityState?this.stop():this.crashed||(this.tRex.reset(),this.play())},playSound(t){t&&t.play()},invert(t){const e=document.firstElementChild;t?(e.classList.toggle(Runner.classes.INVERTED,!1),this.invertTimer=0,this.inverted=!1):this.inverted=e.classList.toggle(Runner.classes.INVERTED,this.invertTrigger)}},Runner.updateCanvasScaling=function(t,e,i){const s=t.getContext("2d");var n=Math.floor(window.devicePixelRatio)||1,a=Math.floor(s.webkitBackingStorePixelRatio)||1,o=n/a;if(n===a)return 1===n&&(t.style.width=t.width+"px",t.style.height=t.height+"px"),!1;e=e||t.width,i=i||t.height;return t.width=e*o,t.height=i*o,t.style.width=e+"px",t.style.height=i+"px",s.scale(o,o),!0},Runner.isAltGameModeEnabled=function(){return loadTimeData&&loadTimeData.valueExists("enableAltGameMode")},GeneratedSoundFx.prototype={init(){this.audioCues=!0,this.context||(this.context=new(window.webkitAudioContext?webkitAudioContext:AudioContext),IS_IOS&&(this.context.onstatechange=function(){"running"!=this.context.state&&this.context.resume()}.bind(this),this.context.resume()),this.panner=this.context.createStereoPanner?this.context.createStereoPanner():null)},stopAll(){this.cancelFootSteps()},playNote(t,e,i,s,n){const a=this.context.createOscillator(),o=this.context.createOscillator(),h=this.context.createGain();a.type="triangle",o.type="triangle",h.gain.value=.1,this.panner?(this.panner.pan.value=n||0,a.connect(h).connect(this.panner),o.connect(h).connect(this.panner),this.panner.connect(this.context.destination)):(a.connect(h),o.connect(h),h.connect(this.context.destination)),a.frequency.value=t+1,o.frequency.value=t-2,h.gain.setValueAtTime(s||.01,e+i-.05),h.gain.linearRampToValueAtTime(1e-5,e+i),a.start(e),o.start(e),a.stop(e+i),o.stop(e+i)},background(){var t;this.audioCues&&(t=this.context.currentTime,this.playNote(493.883,t,.116),this.playNote(659.255,t+.116,.232),this.loopFootSteps())},loopFootSteps(){this.audioCues&&!this.bgSoundIntervalId&&(this.bgSoundIntervalId=setInterval(function(){this.playNote(73.42,this.context.currentTime,.05,.16),this.playNote(69.3,this.context.currentTime+.116,.116,.16)}.bind(this),280))},cancelFootSteps(){this.audioCues&&this.bgSoundIntervalId&&(clearInterval(this.bgSoundIntervalId),this.bgSoundIntervalId=null,this.playNote(103.83,this.context.currentTime,.232,.02),this.playNote(116.54,this.context.currentTime+.116,.232,.02))},collect(){var t;this.audioCues&&(this.cancelFootSteps(),t=this.context.currentTime,this.playNote(830.61,t,.116),this.playNote(1318.51,t+.116,.232))},jump(){var t;this.audioCues&&(t=this.context.currentTime,this.playNote(659.25,t,.116,.3,-.6),this.playNote(880,t+.116,.232,.3,-.6))}},GameOverPanel.RESTART_ANIM_DURATION=875,GameOverPanel.LOGO_PAUSE_DURATION=875,GameOverPanel.FLASH_ITERATIONS=5,GameOverPanel.animConfig={frames:[0,36,72,108,144,180,216,252],msPerFrame:GameOverPanel.RESTART_ANIM_DURATION/8},GameOverPanel.dimensions={TEXT_X:0,TEXT_Y:13,TEXT_WIDTH:191,TEXT_HEIGHT:11,RESTART_WIDTH:36,RESTART_HEIGHT:32},GameOverPanel.prototype={updateDimensions(t,e){this.canvasDimensions.WIDTH=t,e&&(this.canvasDimensions.HEIGHT=e),this.currentFrame=GameOverPanel.animConfig.frames.length-1},drawGameOverText(t,e){var i=this.canvasDimensions.WIDTH/2;let s=t.TEXT_X,n=t.TEXT_Y,a=t.TEXT_WIDTH,o=t.TEXT_HEIGHT;var h=Math.round(i-t.TEXT_WIDTH/2),r=Math.round((this.canvasDimensions.HEIGHT-25)/3),i=t.TEXT_WIDTH,t=t.TEXT_HEIGHT;IS_HIDPI&&(n*=2,s*=2,a*=2,o*=2),e||(s+=this.textImgPos.x,n+=this.textImgPos.y);e=e?Runner.altCommonImageSprite:Runner.origImageSprite;this.canvasCtx.save(),IS_RTL&&(this.canvasCtx.translate(this.canvasDimensions.WIDTH,0),this.canvasCtx.scale(-1,1)),this.canvasCtx.drawImage(e,s,n,a,o,h,r,i,t),this.canvasCtx.restore()},drawAltGameElements(i){if(this.altGameModeActive&&Runner.spriteDefinition.ALT_GAME_END_CONFIG){var s=Runner.spriteDefinition.ALT_GAME_END_CONFIG;let t=s.WIDTH,e=s.HEIGHT;var n=i.xPos+s.X_OFFSET,i=i.yPos+s.Y_OFFSET;IS_HIDPI&&(t*=2,e*=2),this.canvasCtx.drawImage(Runner.altCommonImageSprite,this.altGameEndImgPos.x,this.altGameEndImgPos.y,t,e,n,i,s.WIDTH,s.HEIGHT)}},drawRestartButton(){var t=GameOverPanel.dimensions;let e=GameOverPanel.animConfig.frames[this.currentFrame],i=t.RESTART_WIDTH,s=t.RESTART_HEIGHT;var n=this.canvasDimensions.WIDTH/2-t.RESTART_WIDTH/2,a=this.canvasDimensions.HEIGHT/2;IS_HIDPI&&(i*=2,s*=2,e*=2),this.canvasCtx.save(),IS_RTL&&(this.canvasCtx.translate(this.canvasDimensions.WIDTH,0),this.canvasCtx.scale(-1,1)),this.canvasCtx.drawImage(Runner.origImageSprite,this.restartImgPos.x+e,this.restartImgPos.y,i,s,n,a,t.RESTART_WIDTH,t.RESTART_HEIGHT),this.canvasCtx.restore()},draw(t,e){t&&(this.altGameModeActive=t),this.drawGameOverText(GameOverPanel.dimensions,!1),this.drawRestartButton(),this.drawAltGameElements(e),this.update()},update(){var t=getTimeStamp(),e=t-(this.frameTimeStamp||t);if(this.frameTimeStamp=t,this.animTimer+=e,this.flashTimer+=e,0==this.currentFrame&&this.animTimer>GameOverPanel.LOGO_PAUSE_DURATION)this.animTimer=0,this.currentFrame++,this.drawRestartButton();else if(0<this.currentFrame&&this.currentFrame<GameOverPanel.animConfig.frames.length)this.animTimer>=GameOverPanel.animConfig.msPerFrame&&(this.currentFrame++,this.drawRestartButton());else if(!this.altGameModeActive&&this.currentFrame==GameOverPanel.animConfig.frames.length)return void this.reset();if(this.altGameModeActive&&Runner.spriteDefinitionByType.original.ALT_GAME_OVER_TEXT_CONFIG){e=Runner.spriteDefinitionByType.original.ALT_GAME_OVER_TEXT_CONFIG;if(this.flashCounter<GameOverPanel.FLASH_ITERATIONS&&this.flashTimer>e.FLASH_DURATION)this.flashTimer=0,this.originalText=!this.originalText,this.clearGameOverTextBounds(),this.originalText?(this.drawGameOverText(GameOverPanel.dimensions,!1),this.flashCounter++):this.drawGameOverText(e,!0);else if(this.flashCounter>=GameOverPanel.FLASH_ITERATIONS)return void this.reset()}this.gameOverRafId=requestAnimationFrame(this.update.bind(this))},clearGameOverTextBounds(){this.canvasCtx.save(),this.canvasCtx.clearRect(Math.round(this.canvasDimensions.WIDTH/2-GameOverPanel.dimensions.TEXT_WIDTH/2),Math.round((this.canvasDimensions.HEIGHT-25)/3),GameOverPanel.dimensions.TEXT_WIDTH,GameOverPanel.dimensions.TEXT_HEIGHT+4),this.canvasCtx.restore()},reset(){this.gameOverRafId&&(cancelAnimationFrame(this.gameOverRafId),this.gameOverRafId=null),this.animTimer=0,this.frameTimeStamp=0,this.currentFrame=0,this.flashTimer=0,this.flashCounter=0,this.originalText=!0}},Obstacle.MAX_GAP_COEFFICIENT=1.5,Obstacle.MAX_OBSTACLE_LENGTH=3,Obstacle.prototype={init(t){var e;this.cloneCollisionBoxes(),1<this.size&&this.typeConfig.multipleSpeed>t&&(this.size=1),this.width=this.typeConfig.width*this.size,Array.isArray(this.typeConfig.yPos)?(e=IS_MOBILE?this.typeConfig.yPosMobile:this.typeConfig.yPos,this.yPos=e[getRandomNum(0,e.length-1)]):this.yPos=this.typeConfig.yPos,this.draw(),1<this.size&&(this.collisionBoxes[1].width=this.width-this.collisionBoxes[0].width-this.collisionBoxes[2].width,this.collisionBoxes[2].x=this.width-this.collisionBoxes[2].width),this.typeConfig.speedOffset&&(this.speedOffset=.5<Math.random()?this.typeConfig.speedOffset:-this.typeConfig.speedOffset),this.gap=this.getGap(this.gapCoefficient,t),Runner.audioCues&&(this.gap*=2)},draw(){let t=this.typeConfig.width,e=this.typeConfig.height;IS_HIDPI&&(t*=2,e*=2);let i=t*this.size*(.5*(this.size-1))+this.spritePos.x;0<this.currentFrame&&(i+=t*this.currentFrame),this.canvasCtx.drawImage(this.imageSprite,i,this.spritePos.y,t*this.size,e,this.xPos,this.yPos,this.typeConfig.width*this.size,this.typeConfig.height)},update(t,e){this.remove||(this.typeConfig.speedOffset&&(e+=this.speedOffset),this.xPos-=Math.floor(e*FPS/1e3*t),this.typeConfig.numFrames&&(this.timer+=t,this.timer>=this.typeConfig.frameRate&&(this.currentFrame=this.currentFrame===this.typeConfig.numFrames-1?0:this.currentFrame+1,this.timer=0)),this.draw(),this.isVisible()||(this.remove=!0))},getGap(t,e){t=Math.round(this.width*e+this.typeConfig.minGap*t);return getRandomNum(t,Math.round(t*Obstacle.MAX_GAP_COEFFICIENT))},isVisible(){return 0<this.xPos+this.width},cloneCollisionBoxes(){var e=this.typeConfig.collisionBoxes;for(let t=e.length-1;0<=t;t--)this.collisionBoxes[t]=new CollisionBox(e[t].x,e[t].y,e[t].width,e[t].height)}},Trex.config={DROP_VELOCITY:-5,FLASH_OFF:175,FLASH_ON:100,HEIGHT:47,HEIGHT_DUCK:25,INTRO_DURATION:1500,SPEED_DROP_COEFFICIENT:3,SPRITE_WIDTH:262,START_X_POS:50,WIDTH:44,WIDTH_DUCK:59},Trex.slowJumpConfig={GRAVITY:.25,MAX_JUMP_HEIGHT:50,MIN_JUMP_HEIGHT:45,INITIAL_JUMP_VELOCITY:-20},Trex.normalJumpConfig={GRAVITY:.6,MAX_JUMP_HEIGHT:30,MIN_JUMP_HEIGHT:30,INITIAL_JUMP_VELOCITY:-10},Trex.collisionBoxes={DUCKING:[new CollisionBox(1,18,55,25)],RUNNING:[new CollisionBox(22,0,17,16),new CollisionBox(1,18,30,9),new CollisionBox(10,35,14,8),new CollisionBox(1,24,29,5),new CollisionBox(5,30,21,4),new CollisionBox(9,34,15,4)]},Trex.status={CRASHED:"CRASHED",DUCKING:"DUCKING",JUMPING:"JUMPING",RUNNING:"RUNNING",WAITING:"WAITING"},Trex.BLINK_TIMING=7e3,Trex.animFrames={WAITING:{frames:[44,0],msPerFrame:1e3/3},RUNNING:{frames:[88,132],msPerFrame:1e3/12},CRASHED:{frames:[220],msPerFrame:1e3/60},JUMPING:{frames:[0],msPerFrame:1e3/60},DUCKING:{frames:[264,323],msPerFrame:125}},Trex.prototype={init(){this.groundYPos=Runner.defaultDimensions.HEIGHT-this.config.HEIGHT-Runner.config.BOTTOM_PAD,this.yPos=this.groundYPos,this.minJumpHeight=this.groundYPos-this.config.MIN_JUMP_HEIGHT,this.draw(0,0),this.update(0,Trex.status.WAITING)},enableSlowConfig:function(){var t=Runner.slowDown?Trex.slowJumpConfig:Trex.normalJumpConfig;Trex.config=Object.assign(Trex.config,t),this.adjustAltGameConfigForSlowSpeed()},enableAltGameMode:function(t){this.altGameModeEnabled=!0,this.spritePos=t;t=Runner.spriteDefinition.TREX;Trex.animFrames.RUNNING.frames=[t.RUNNING_1.x,t.RUNNING_2.x],Trex.animFrames.CRASHED.frames=[t.CRASHED.x],"object"==typeof t.JUMPING.x?Trex.animFrames.JUMPING.frames=t.JUMPING.x:Trex.animFrames.JUMPING.frames=[t.JUMPING.x],Trex.animFrames.DUCKING.frames=[t.RUNNING_1.x,t.RUNNING_2.x],Trex.config.GRAVITY=t.GRAVITY||Trex.config.GRAVITY,Trex.config.HEIGHT=t.RUNNING_1.h,Trex.config.INITIAL_JUMP_VELOCITY=t.INITIAL_JUMP_VELOCITY,Trex.config.MAX_JUMP_HEIGHT=t.MAX_JUMP_HEIGHT,Trex.config.MIN_JUMP_HEIGHT=t.MIN_JUMP_HEIGHT,Trex.config.WIDTH=t.RUNNING_1.w,Trex.config.WIDTH_JUMP=t.JUMPING.w,Trex.config.INVERT_JUMP=t.INVERT_JUMP,this.adjustAltGameConfigForSlowSpeed(t.GRAVITY),this.config=Trex.config,this.groundYPos=Runner.defaultDimensions.HEIGHT-this.config.HEIGHT-Runner.spriteDefinition.BOTTOM_PAD,this.yPos=this.groundYPos,this.reset()},adjustAltGameConfigForSlowSpeed:function(t){Runner.slowDown&&(t&&(Trex.config.GRAVITY=t/1.5),Trex.config.MIN_JUMP_HEIGHT*=1.5,Trex.config.MAX_JUMP_HEIGHT*=1.5,Trex.config.INITIAL_JUMP_VELOCITY=1.5*Trex.config.INITIAL_JUMP_VELOCITY)},setFlashing:function(t){this.flashing=t},setJumpVelocity(t){this.config.INITIAL_JUMP_VELOCITY=-t,this.config.DROP_VELOCITY=-t/2},update(t,e){this.timer+=t,e&&(this.status=e,this.currentFrame=0,this.msPerFrame=Trex.animFrames[e].msPerFrame,this.currentAnimFrames=Trex.animFrames[e].frames,e===Trex.status.WAITING&&(this.animStartTime=getTimeStamp(),this.setBlinkDelay())),this.playingIntro&&this.xPos<this.config.START_X_POS&&(this.xPos+=Math.round(this.config.START_X_POS/this.config.INTRO_DURATION*t),this.xInitialPos=this.xPos),this.status===Trex.status.WAITING?this.blink(getTimeStamp()):this.draw(this.currentAnimFrames[this.currentFrame],0),!this.flashing&&this.timer>=this.msPerFrame&&(this.currentFrame=this.currentFrame==this.currentAnimFrames.length-1?0:this.currentFrame+1,this.timer=0),this.altGameModeEnabled||this.speedDrop&&this.yPos===this.groundYPos&&(this.speedDrop=!1,this.setDuck(!0))},draw(t,e){let i=t,s=e,n=this.ducking&&this.status!==Trex.status.CRASHED?this.config.WIDTH_DUCK:this.config.WIDTH,a=this.config.HEIGHT;e=a;let o=Runner.spriteDefinition.TREX.JUMPING.xOffset;this.altGameModeEnabled&&this.jumping&&this.status!==Trex.status.CRASHED&&(n=this.config.WIDTH_JUMP),IS_HIDPI&&(i*=2,s*=2,n*=2,a*=2,o*=2),i+=this.spritePos.x,s+=this.spritePos.y,this.flashing&&(this.timer<this.config.FLASH_ON?this.canvasCtx.globalAlpha=.5:this.timer>this.config.FLASH_OFF&&(this.timer=0)),!this.altGameModeEnabled&&this.ducking&&this.status!==Trex.status.CRASHED?this.canvasCtx.drawImage(Runner.imageSprite,i,s,n,a,this.xPos,this.yPos,this.config.WIDTH_DUCK,e):this.altGameModeEnabled&&this.jumping&&this.status!==Trex.status.CRASHED?this.canvasCtx.drawImage(Runner.imageSprite,i,s,n,a,this.xPos-o,this.yPos,this.config.WIDTH_JUMP,e):(this.ducking&&this.status===Trex.status.CRASHED&&this.xPos++,this.canvasCtx.drawImage(Runner.imageSprite,i,s,n,a,this.xPos,this.yPos,this.config.WIDTH,e)),this.canvasCtx.globalAlpha=1},setBlinkDelay(){this.blinkDelay=Math.ceil(Math.random()*Trex.BLINK_TIMING)},blink(t){t-this.animStartTime>=this.blinkDelay&&(this.draw(this.currentAnimFrames[this.currentFrame],0),1===this.currentFrame&&(this.setBlinkDelay(),this.animStartTime=t,this.blinkCount++))},startJump(t){this.jumping||(this.update(0,Trex.status.JUMPING),this.jumpVelocity=this.config.INITIAL_JUMP_VELOCITY-t/10,this.jumping=!0,this.reachedMinHeight=!1,this.speedDrop=!1,this.config.INVERT_JUMP&&(this.minJumpHeight=this.groundYPos+this.config.MIN_JUMP_HEIGHT))},endJump(){this.reachedMinHeight&&this.jumpVelocity<this.config.DROP_VELOCITY&&(this.jumpVelocity=this.config.DROP_VELOCITY)},updateJump(t){t/=Trex.animFrames[this.status].msPerFrame;this.speedDrop?this.yPos+=Math.round(this.jumpVelocity*this.config.SPEED_DROP_COEFFICIENT*t):this.config.INVERT_JUMP?this.yPos-=Math.round(this.jumpVelocity*t):this.yPos+=Math.round(this.jumpVelocity*t),this.jumpVelocity+=this.config.GRAVITY*t,(this.config.INVERT_JUMP&&this.yPos>this.minJumpHeight||!this.config.INVERT_JUMP&&this.yPos<this.minJumpHeight||this.speedDrop)&&(this.reachedMinHeight=!0),(this.config.INVERT_JUMP&&this.yPos>-this.config.MAX_JUMP_HEIGHT||!this.config.INVERT_JUMP&&this.yPos<this.config.MAX_JUMP_HEIGHT||this.speedDrop)&&this.endJump(),((this.config.INVERT_JUMP&&this.yPos)<this.groundYPos||(!this.config.INVERT_JUMP&&this.yPos)>this.groundYPos)&&(this.reset(),this.jumpCount++,Runner.audioCues&&Runner.generatedSoundFx.loopFootSteps())},setSpeedDrop(){this.speedDrop=!0,this.jumpVelocity=1},setDuck(t){t&&this.status!==Trex.status.DUCKING?(this.update(0,Trex.status.DUCKING),this.ducking=!0):this.status===Trex.status.DUCKING&&(this.update(0,Trex.status.RUNNING),this.ducking=!1)},reset(){this.xPos=this.xInitialPos,this.yPos=this.groundYPos,this.jumpVelocity=0,this.jumping=!1,this.ducking=!1,this.update(0,Trex.status.RUNNING),this.midair=!1,this.speedDrop=!1,this.jumpCount=0}},DistanceMeter.dimensions={WIDTH:10,HEIGHT:13,DEST_WIDTH:11},DistanceMeter.yPos=[0,13,27,40,53,67,80,93,107,120],DistanceMeter.config={MAX_DISTANCE_UNITS:5,ACHIEVEMENT_DISTANCE:100,COEFFICIENT:.025,FLASH_DURATION:250,FLASH_ITERATIONS:3,HIGH_SCORE_HIT_AREA_PADDING:4},DistanceMeter.prototype={init(t){let e="";this.calcXPos(t),this.maxScore=this.maxScoreUnits;for(let t=0;t<this.maxScoreUnits;t++)this.draw(t,0),this.defaultString+="0",e+="9";this.maxScore=parseInt(e,10)},calcXPos(t){this.x=t-DistanceMeter.dimensions.DEST_WIDTH*(this.maxScoreUnits+1)},draw(t,e,i){let s=DistanceMeter.dimensions.WIDTH,n=DistanceMeter.dimensions.HEIGHT,a=DistanceMeter.dimensions.WIDTH*e;var o=0,h=t*DistanceMeter.dimensions.DEST_WIDTH,r=this.y,l=DistanceMeter.dimensions.WIDTH,e=DistanceMeter.dimensions.HEIGHT;IS_HIDPI&&(s*=2,n*=2,a*=2),a+=this.spritePos.x,o+=this.spritePos.y,this.canvasCtx.save(),IS_RTL?(i?this.canvasCtx.translate(this.canvasWidth-DistanceMeter.dimensions.WIDTH*(this.maxScoreUnits+3),this.y):this.canvasCtx.translate(this.canvasWidth-DistanceMeter.dimensions.WIDTH,this.y),this.canvasCtx.scale(-1,1)):(t=this.x-2*this.maxScoreUnits*DistanceMeter.dimensions.WIDTH,i?this.canvasCtx.translate(t,this.y):this.canvasCtx.translate(this.x,this.y)),this.canvasCtx.drawImage(this.image,a,o,s,n,h,r,l,e),this.canvasCtx.restore()},getActualDistance(t){return t?Math.round(t*this.config.COEFFICIENT):0},update(t,e){let i=!0,s=!1;if(this.achievement)this.flashIterations<=this.config.FLASH_ITERATIONS?(this.flashTimer+=t,this.flashTimer<this.config.FLASH_DURATION?i=!1:this.flashTimer>2*this.config.FLASH_DURATION&&(this.flashTimer=0,this.flashIterations++)):(this.achievement=!1,this.flashIterations=0,this.flashTimer=0);else if((e=this.getActualDistance(e))>this.maxScore&&this.maxScoreUnits==this.config.MAX_DISTANCE_UNITS?(this.maxScoreUnits++,this.maxScore=parseInt(this.maxScore+"9",10)):this.distance=0,0<e){e%this.config.ACHIEVEMENT_DISTANCE==0&&(this.achievement=!0,this.flashTimer=0,s=!0);const n=(this.defaultString+e).substr(-this.maxScoreUnits);this.digits=n.split("")}else this.digits=this.defaultString.split("");if(i)for(let t=this.digits.length-1;0<=t;t--)this.draw(t,parseInt(this.digits[t],10));return this.drawHighScore(),s},drawHighScore(){if(0<parseInt(this.highScore,10)){this.canvasCtx.save(),this.canvasCtx.globalAlpha=.8;for(let t=this.highScore.length-1;0<=t;t--)this.draw(t,parseInt(this.highScore[t],10),!0);this.canvasCtx.restore()}},setHighScore(t){t=this.getActualDistance(t);const e=(this.defaultString+t).substr(-this.maxScoreUnits);this.highScore=["10","11",""].concat(e.split(""))},hasClickedOnHighScore(t){let e=0,i=0;var s;return i=t.touches?(s=this.canvas.getBoundingClientRect(),e=t.touches[0].clientX-s.left,t.touches[0].clientY-s.top):(e=t.offsetX,t.offsetY),this.highScoreBounds=this.getHighScoreBounds(),e>=this.highScoreBounds.x&&e<=this.highScoreBounds.x+this.highScoreBounds.width&&i>=this.highScoreBounds.y&&i<=this.highScoreBounds.y+this.highScoreBounds.height},getHighScoreBounds(){return{x:this.x-2*this.maxScoreUnits*DistanceMeter.dimensions.WIDTH-DistanceMeter.config.HIGH_SCORE_HIT_AREA_PADDING,y:this.y,width:DistanceMeter.dimensions.WIDTH*(this.highScore.length+1)+DistanceMeter.config.HIGH_SCORE_HIT_AREA_PADDING,height:DistanceMeter.dimensions.HEIGHT+2*DistanceMeter.config.HIGH_SCORE_HIT_AREA_PADDING}},flashHighScore(){var t=getTimeStamp(),e=t-(this.frameTimeStamp||t);let i=!0;this.frameTimeStamp=t,this.flashIterations>2*this.config.FLASH_ITERATIONS?this.cancelHighScoreFlashing():(this.flashTimer+=e,this.flashTimer<this.config.FLASH_DURATION?i=!1:this.flashTimer>2*this.config.FLASH_DURATION&&(this.flashTimer=0,this.flashIterations++),i?this.drawHighScore():this.clearHighScoreBounds(),this.flashingRafId=requestAnimationFrame(this.flashHighScore.bind(this)))},clearHighScoreBounds(){this.canvasCtx.save(),this.canvasCtx.fillStyle="#fff",this.canvasCtx.rect(this.highScoreBounds.x,this.highScoreBounds.y,this.highScoreBounds.width,this.highScoreBounds.height),this.canvasCtx.fill(),this.canvasCtx.restore()},startHighScoreFlashing(){this.highScoreFlashing=!0,this.flashHighScore()},isHighScoreFlashing(){return this.highScoreFlashing},cancelHighScoreFlashing(){this.flashingRafId&&cancelAnimationFrame(this.flashingRafId),this.flashIterations=0,this.flashTimer=0,this.highScoreFlashing=!1,this.clearHighScoreBounds(),this.drawHighScore()},resetHighScore(){this.setHighScore(0),this.cancelHighScoreFlashing()},reset(){this.update(0,0),this.achievement=!1}},Cloud.config={HEIGHT:14,MAX_CLOUD_GAP:400,MAX_SKY_LEVEL:30,MIN_CLOUD_GAP:100,MIN_SKY_LEVEL:71,WIDTH:46},Cloud.prototype={init(){this.yPos=getRandomNum(Cloud.config.MAX_SKY_LEVEL,Cloud.config.MIN_SKY_LEVEL),this.draw()},draw(){this.canvasCtx.save();let t=Cloud.config.WIDTH,e=Cloud.config.HEIGHT;var i=t,s=e;IS_HIDPI&&(t*=2,e*=2),this.canvasCtx.drawImage(Runner.imageSprite,this.spritePos.x,this.spritePos.y,t,e,this.xPos,this.yPos,i,s),this.canvasCtx.restore()},update(t){this.remove||(this.xPos-=Math.ceil(t),this.draw(),this.isVisible()||(this.remove=!0))},isVisible(){return 0<this.xPos+Cloud.config.WIDTH}},BackgroundEl.config={MAX_BG_ELS:0,MAX_GAP:0,MIN_GAP:0,POS:0,SPEED:0,Y_POS:0,MS_PER_FRAME:0},BackgroundEl.prototype={init(){this.spriteConfig=Runner.spriteDefinition.BACKGROUND_EL[this.type],this.spriteConfig.FIXED&&(this.xPos=this.spriteConfig.FIXED_X_POS),this.yPos=BackgroundEl.config.Y_POS-this.spriteConfig.HEIGHT+this.spriteConfig.OFFSET,this.draw()},draw(){this.canvasCtx.save();let t=this.spriteConfig.WIDTH,e=this.spriteConfig.HEIGHT,i=this.spriteConfig.X_POS;var s=t,n=e;IS_HIDPI&&(t*=2,e*=2,i*=2),this.canvasCtx.drawImage(Runner.imageSprite,i,this.spritePos.y,t,e,this.xPos,this.yPos,s,n),this.canvasCtx.restore()},update(t){this.remove||(this.spriteConfig.FIXED?(this.animTimer+=t,this.animTimer>BackgroundEl.config.MS_PER_FRAME&&(this.animTimer=0,this.switchFrames=!this.switchFrames),this.spriteConfig.FIXED_Y_POS_1&&this.spriteConfig.FIXED_Y_POS_2&&(this.yPos=this.switchFrames?this.spriteConfig.FIXED_Y_POS_1:this.spriteConfig.FIXED_Y_POS_2)):this.xPos-=BackgroundEl.config.SPEED,this.draw(),this.isVisible()||(this.remove=!0))},isVisible(){return 0<this.xPos+this.spriteConfig.WIDTH}},NightMode.config={FADE_SPEED:.035,HEIGHT:40,MOON_SPEED:.25,NUM_STARS:2,STAR_SIZE:9,STAR_SPEED:.3,STAR_MAX_Y:70,WIDTH:20},NightMode.phases=[140,120,100,60,40,20,0],NightMode.prototype={update(t){if(t&&0===this.opacity&&(this.currentPhase++,this.currentPhase>=NightMode.phases.length&&(this.currentPhase=0)),t&&(this.opacity<1||0===this.opacity)?this.opacity+=NightMode.config.FADE_SPEED:0<this.opacity&&(this.opacity-=NightMode.config.FADE_SPEED),0<this.opacity){if(this.xPos=this.updateXPos(this.xPos,NightMode.config.MOON_SPEED),this.drawStars)for(let t=0;t<NightMode.config.NUM_STARS;t++)this.stars[t].x=this.updateXPos(this.stars[t].x,NightMode.config.STAR_SPEED);this.draw()}else this.opacity=0,this.placeStars();this.drawStars=!0},updateXPos(t,e){return t<-NightMode.config.WIDTH?t=this.containerWidth:t-=e,t},draw(){let t=3===this.currentPhase?2*NightMode.config.WIDTH:NightMode.config.WIDTH,e=NightMode.config.HEIGHT,i=this.spritePos.x+NightMode.phases[this.currentPhase];var s=t;let n=NightMode.config.STAR_SIZE,a=Runner.spriteDefinitionByType.original.LDPI.STAR.x;if(IS_HIDPI&&(t*=2,e*=2,i=this.spritePos.x+2*NightMode.phases[this.currentPhase],n*=2,a=Runner.spriteDefinitionByType.original.HDPI.STAR.x),this.canvasCtx.save(),this.canvasCtx.globalAlpha=this.opacity,this.drawStars)for(let t=0;t<NightMode.config.NUM_STARS;t++)this.canvasCtx.drawImage(Runner.origImageSprite,a,this.stars[t].sourceY,n,n,Math.round(this.stars[t].x),this.stars[t].y,NightMode.config.STAR_SIZE,NightMode.config.STAR_SIZE);this.canvasCtx.drawImage(Runner.origImageSprite,i,this.spritePos.y,t,e,Math.round(this.xPos),this.yPos,s,NightMode.config.HEIGHT),this.canvasCtx.globalAlpha=1,this.canvasCtx.restore()},placeStars(){var e=Math.round(this.containerWidth/NightMode.config.NUM_STARS);for(let t=0;t<NightMode.config.NUM_STARS;t++)this.stars[t]={},this.stars[t].x=getRandomNum(e*t,e*(t+1)),this.stars[t].y=getRandomNum(0,NightMode.config.STAR_MAX_Y),IS_HIDPI?this.stars[t].sourceY=Runner.spriteDefinitionByType.original.HDPI.STAR.y+2*NightMode.config.STAR_SIZE*t:this.stars[t].sourceY=Runner.spriteDefinitionByType.original.LDPI.STAR.y+NightMode.config.STAR_SIZE*t},reset(){this.currentPhase=0,this.opacity=0,this.update(!1)}},HorizonLine.dimensions={WIDTH:600,HEIGHT:12,YPOS:127},HorizonLine.prototype={setSourceDimensions(t){for(const e in t)"SOURCE_X"!==e&&"SOURCE_Y"!==e&&(IS_HIDPI?"YPOS"!==e&&(this.sourceDimensions[e]=2*t[e]):this.sourceDimensions[e]=t[e],this.dimensions[e]=t[e]);this.xPos=[0,t.WIDTH],this.yPos=t.YPOS},getRandomType(){return Math.random()>this.bumpThreshold?this.dimensions.WIDTH:0},draw(){this.canvasCtx.drawImage(Runner.imageSprite,this.sourceXPos[0],this.spritePos.y,this.sourceDimensions.WIDTH,this.sourceDimensions.HEIGHT,this.xPos[0],this.yPos,this.dimensions.WIDTH,this.dimensions.HEIGHT),this.canvasCtx.drawImage(Runner.imageSprite,this.sourceXPos[1],this.spritePos.y,this.sourceDimensions.WIDTH,this.sourceDimensions.HEIGHT,this.xPos[1],this.yPos,this.dimensions.WIDTH,this.dimensions.HEIGHT)},updateXPos(t,e){var i=t,t=0===t?1:0;this.xPos[i]-=e,this.xPos[t]=this.xPos[i]+this.dimensions.WIDTH,this.xPos[i]<=-this.dimensions.WIDTH&&(this.xPos[i]+=2*this.dimensions.WIDTH,this.xPos[t]=this.xPos[i]-this.dimensions.WIDTH,this.sourceXPos[i]=this.getRandomType()+this.spritePos.x)},update(t,e){t=Math.floor(e*(FPS/1e3)*t);this.xPos[0]<=0?this.updateXPos(0,t):this.updateXPos(1,t),this.draw()},reset(){this.xPos[0]=0,this.xPos[1]=this.dimensions.WIDTH}},Horizon.config={BG_CLOUD_SPEED:.2,BUMPY_THRESHOLD:.3,CLOUD_FREQUENCY:.5,HORIZON_HEIGHT:16,MAX_CLOUDS:6},Horizon.prototype={init(){Obstacle.types=Runner.spriteDefinitionByType.original.OBSTACLES,this.addCloud();for(let t=0;t<Runner.spriteDefinition.LINES.length;t++)this.horizonLines.push(new HorizonLine(this.canvas,Runner.spriteDefinition.LINES[t]));this.nightMode=new NightMode(this.canvas,this.spritePos.MOON,this.dimensions.WIDTH)},adjustObstacleSpeed:function(){for(let t=0;t<Obstacle.types.length;t++)Runner.slowDown&&(Obstacle.types[t].multipleSpeed=Obstacle.types[t].multipleSpeed/2,Obstacle.types[t].minGap*=1.5,Obstacle.types[t].minSpeed=Obstacle.types[t].minSpeed/2,"object"==typeof Obstacle.types[t].yPos&&(Obstacle.types[t].yPos=Obstacle.types[t].yPos[0],Obstacle.types[t].yPosMobile=Obstacle.types[t].yPos[0]))},enableAltGameMode:function(t){this.clouds=[],this.backgroundEls=[],this.altGameModeActive=!0,this.spritePos=t,Obstacle.types=Runner.spriteDefinition.OBSTACLES,this.adjustObstacleSpeed(),Obstacle.MAX_GAP_COEFFICIENT=Runner.spriteDefinition.MAX_GAP_COEFFICIENT,Obstacle.MAX_OBSTACLE_LENGTH=Runner.spriteDefinition.MAX_OBSTACLE_LENGTH,BackgroundEl.config=Runner.spriteDefinition.BACKGROUND_EL_CONFIG,this.horizonLines=[];for(let t=0;t<Runner.spriteDefinition.LINES.length;t++)this.horizonLines.push(new HorizonLine(this.canvas,Runner.spriteDefinition.LINES[t]));this.reset()},update(e,i,t,s){this.runningTime+=e,this.altGameModeActive&&this.updateBackgroundEls(e,i);for(let t=0;t<this.horizonLines.length;t++)this.horizonLines[t].update(e,i);this.altGameModeActive&&!Runner.spriteDefinition.HAS_CLOUDS||(this.nightMode.update(s),this.updateClouds(e,i)),t&&this.updateObstacles(e,i)},updateBackgroundEl(e,i,t,s,n){var a=i.length;if(a){for(let t=a-1;0<=t;t--)i[t].update(e);var o=i[a-1];a<t&&this.dimensions.WIDTH-o.xPos>o.gap&&n>Math.random()&&s()}else s()},updateClouds(t,e){e=this.cloudSpeed/1e3*t*e;this.updateBackgroundEl(e,this.clouds,this.config.MAX_CLOUDS,this.addCloud.bind(this),this.cloudFrequency),this.clouds=this.clouds.filter(t=>!t.remove)},updateBackgroundEls(t,e){this.updateBackgroundEl(t,this.backgroundEls,BackgroundEl.config.MAX_BG_ELS,this.addBackgroundEl.bind(this),this.cloudFrequency),this.backgroundEls=this.backgroundEls.filter(t=>!t.remove)},updateObstacles(e,i){const s=this.obstacles.slice(0);for(let t=0;t<this.obstacles.length;t++){const n=this.obstacles[t];n.update(e,i),n.remove&&s.shift()}if(this.obstacles=s,0<this.obstacles.length){const t=this.obstacles[this.obstacles.length-1];t&&!t.followingObstacleCreated&&t.isVisible()&&t.xPos+t.width+t.gap<this.dimensions.WIDTH&&(this.addNewObstacle(i),t.followingObstacleCreated=!0)}else this.addNewObstacle(i)},removeFirstObstacle(){this.obstacles.shift()},addNewObstacle(t){var e="COLLECTABLE"!=Obstacle.types[Obstacle.types.length-1].type||Runner.isAltGameModeEnabled()&&!this.altGameModeActive||this.altGameModeActive?Obstacle.types.length-1:Obstacle.types.length-2,i=0<e?getRandomNum(0,e):0,i=Obstacle.types[i];0<e&&this.duplicateObstacleCheck(i.type)||t<i.minSpeed?this.addNewObstacle(t):(e=this.spritePos[i.type],this.obstacles.push(new Obstacle(this.canvasCtx,i,e,this.dimensions,this.gapCoefficient,t,i.width,this.altGameModeActive)),this.obstacleHistory.unshift(i.type),1<this.obstacleHistory.length&&this.obstacleHistory.splice(Runner.config.MAX_OBSTACLE_DUPLICATION))},duplicateObstacleCheck(e){let i=0;for(let t=0;t<this.obstacleHistory.length;t++)i=this.obstacleHistory[t]===e?i+1:0;return i>=Runner.config.MAX_OBSTACLE_DUPLICATION},reset(){this.obstacles=[];for(let t=0;t<this.horizonLines.length;t++)this.horizonLines[t].reset();this.nightMode.reset()},resize(t,e){this.canvas.width=t,this.canvas.height=e},addCloud(){this.clouds.push(new Cloud(this.canvas,this.spritePos.CLOUD,this.dimensions.WIDTH))},addBackgroundEl(){var e,i=Object.keys(Runner.spriteDefinition.BACKGROUND_EL);if(0<i.length){let t=i[e=getRandomNum(0,i.length-1)];for(;t==this.lastEl&&1<i.length;)e=getRandomNum(0,i.length-1),t=i[e];this.lastEl=t,this.backgroundEls.push(new BackgroundEl(this.canvas,this.spritePos.BACKGROUND_EL,this.dimensions.WIDTH,t))}}};